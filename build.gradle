plugins {
    // bintray
    id "com.jfrog.bintray" version "1.6"
}

group = 'org.omegat.gradle'
version = currentVersion

apply plugin: 'groovy'
apply plugin: 'maven'
apply plugin: 'com.jfrog.bintray'

repositories {
    jcenter()
}

configurations {
    bundle
}

dependencies {
    compile gradleApi()
    compile localGroovy()
    bundle fileTree('lib') {
        exclude "sources/*"
    }
}

jar {
    from (configurations.bundle.collect { zipTree(it) }) {
        exclude "META-INF/MANIFEST.MF"
    }
    manifest {
        from {zipTree('lib/OmegaT.jar').find {it.name=="MANIFEST.MF"}}
    }
}

compileGroovy {
    sourceCompatibility = '1.8'
    targetCompatibility = '1.8'
}

task sourceJar(type: Jar) {
    from sourceSets.main.allSource
    classifier = 'sources'
}

task createReleasePropertiesFile(type:Exec) {
    String fileName = 'omegat.plugin.release.properties'
    println "Creating $fileName"
    String fileContent = "version=$currentVersion"
    (new File("$rootDir/src/main/resources/$fileName")).write(fileContent)
}

artifacts {
    archives jar
    archives sourceJar
}

task wrapper(type: Wrapper, description: 'Gradle Wrapper task') {
    gradleVersion = '3.0'
}

if (gradle.startParameter.taskNames.contains('uploadArchives') ||
    gradle.startParameter.taskNames.contains('bintrayUpload')) {
  apply from: 'build.publish.gradle'
}
